# Contributors Feature Specification

## æ¦‚è¦

ãƒªãƒã‚¸ãƒˆãƒªä¸€è¦§ãƒšãƒ¼ã‚¸ (`/app`) ã« Contributors åˆ—ã‚’è¿½åŠ ã—ã€å„ãƒªãƒã‚¸ãƒˆãƒªã¸ã®è²¢çŒ®è€…ã‚’è¦–è¦šçš„ã«è¡¨ç¤ºã™ã‚‹ã€‚

## ç›®çš„

- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒã©ã®ãƒªãƒã‚¸ãƒˆãƒªã«è²¢çŒ®ã—ã¦ã„ã‚‹ã‹ã‚’ä¸€ç›®ã§æŠŠæ¡
- ãƒªãƒã‚¸ãƒˆãƒªã®æ´»ç™ºåº¦ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹çŠ¶æ³ã®å¯è¦–åŒ–
- çµ„ç¹”å†…ã®ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ³ã®æŠŠæ¡

---

## GitHub API

### Endpoint

```
GET /repos/{owner}/{repo}/contributors
```

### Parameters

- `per_page`: 100 (æœ€å¤§å€¤)
- `anon`: false (åŒ¿åè²¢çŒ®è€…ã‚’é™¤å¤–)

### Response Fields

```typescript
interface Contributor {
  login: string;           // GitHub username
  id: number;              // User ID
  avatar_url: string;      // Avatar image URL
  html_url: string;        // Profile URL
  contributions: number;   // Contribution count
  type: string;            // "User" or "Bot"
}
```

### Rate Limits

- èªè¨¼æ¸ˆã¿: 5000 requests/hour
- å¤§ããªãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€è¨ˆç®—ã«æ™‚é–“ãŒã‹ã‹ã‚‹å¯èƒ½æ€§ã‚ã‚Š

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è¿½åŠ 

`repo_inventory` ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ :

```typescript
{
  // ... existing fields
  contributors: jsonb("contributors"), // Contributor[]
  contributorsCount: integer("contributors_count").default(0),
  contributorsUpdatedAt: timestamp("contributors_updated_at"),
}
```

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```typescript
// JSON stored in contributors field
type ContributorData = {
  login: string;
  avatarUrl: string;
  profileUrl: string;
  contributions: number;
}[];
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨DBä¿å­˜

1. **GitHub API é–¢æ•°è¿½åŠ ** (`lib/github.ts`)
   ```typescript
   export async function listRepoContributors(
     octokit: Octokit,
     owner: string,
     repo: string
   ): Promise<ContributorData[]>
   ```
   - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼ˆæœ€å¤§100ä»¶å–å¾—ï¼‰
   - Bot ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   - ä¸Šä½10åã®ã¿ä¿å­˜ï¼ˆç”»é¢è¡¨ç¤ºç”¨ï¼‰

2. **ã‚¹ã‚­ãƒ£ãƒ³å‡¦ç†ã¸ã®çµ±åˆ** (`lib/scan.ts`)
   - `scanOneRepo()` å†…ã§ contributors æƒ…å ±ã‚’å–å¾—
   - `initInventory()` ã« contributors ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆ404ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«å¯¾å¿œï¼‰

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°**
   - `lib/db/schema.ts` ã«æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
   - `pnpm db:push` ã§ã‚¹ã‚­ãƒ¼ãƒåæ˜ 

### Phase 2: UIå®Ÿè£…

1. **Contributors åˆ—ã®è¿½åŠ ** (`app/app/page.tsx`)
   - ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ã„åˆ—ã‚’è¿½åŠ 
   - åˆ—é †: `Repository | Last Updated | Language | Frameworks | Contributors`

2. **Contributors è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   ```typescript
   // è¡¨ç¤ºå½¢å¼
   // - ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’æ¨ªä¸¦ã³ã§è¡¨ç¤ºï¼ˆæœ€å¤§5-7äººï¼‰
   // - é‡ãªã‚‹ã‚ˆã†ã«é…ç½®ï¼ˆz-index ã§ã‚¹ã‚¿ãƒƒã‚¯ï¼‰
   // - æ®‹ã‚Šã®äººæ•°ã‚’ "+N" ã§è¡¨ç¤º
   // - ãƒ›ãƒãƒ¼ã§å…¨å“¡ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º
   ```

3. **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**
   - ã‚¢ãƒã‚¿ãƒ¼: 32x32px (å††å½¢)
   - é‡ãªã‚Š: -8px ãƒãƒ¼ã‚¸ãƒ³
   - ãƒ›ãƒãƒ¼åŠ¹æœ: border highlight
   - "+N" ãƒãƒƒã‚¸: å††å½¢ã€ã‚°ãƒ¬ãƒ¼èƒŒæ™¯

### Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

1. **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥**
   - Contributors ã¯é »ç¹ã«å¤‰ã‚ã‚‰ãªã„ãŸã‚ã€7æ—¥é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - `contributorsUpdatedAt` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™ã‚’ç®¡ç†

2. **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°**
   - å®šæœŸçš„ãªãƒãƒƒãƒå‡¦ç†ã§ contributors ã‚’æ›´æ–°
   - QStash ã‚’ä½¿ã£ãŸéåŒæœŸæ›´æ–°

---

## UI/UX ä»•æ§˜

### è¡¨ç¤ºãƒ«ãƒ¼ãƒ«

1. **ä¸Šä½è²¢çŒ®è€…ã®è¡¨ç¤º**
   - æœ€å¤§7åã®ã‚¢ãƒã‚¿ãƒ¼ã‚’è¡¨ç¤º
   - 8äººç›®ä»¥é™ã¯ "+N" ã§é›†ç´„

2. **ç©ºã®çŠ¶æ…‹**
   - Contributors ãŒã„ãªã„å ´åˆ: "-" ã‚’è¡¨ç¤º
   - ã¾ã å–å¾—ã—ã¦ã„ãªã„å ´åˆ: "..." ã‚’è¡¨ç¤º

3. **ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—**
   - ãƒ›ãƒãƒ¼æ™‚: å…¨è²¢çŒ®è€…ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
   - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `@username (123 contributions)`

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Repository  â”‚ Last Updated â”‚ Language â”‚ Frameworks   â”‚ Contributors    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ frontend    â”‚ 2 days ago   â”‚ TypeScr. â”‚ Next.js, ... â”‚ ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤ +3   â”‚
â”‚ backend-api â”‚ 1 week ago   â”‚ Python   â”‚ FastAPI      â”‚ ğŸ‘¤ğŸ‘¤ğŸ‘¤         â”‚
â”‚ infra       â”‚ 3 months ago â”‚ HCL      â”‚ Terraform    â”‚ ğŸ‘¤ğŸ‘¤           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“çš„è€ƒæ…®äº‹é …

### Rate Limit ç®¡ç†

- Contributors API ã¯è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ã„
- ãƒãƒƒãƒå‡¦ç†ã§ä¸¦åˆ—åº¦ã‚’åˆ¶é™ï¼ˆ5-10ä¸¦åˆ—ï¼‰
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- 404: ãƒªãƒã‚¸ãƒˆãƒªãŒå‰Šé™¤ã•ã‚ŒãŸ â†’ contributors: null
- 403/429: Rate limit â†’ ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ¬¡å›ãƒªãƒˆãƒ©ã‚¤
- Timeout: é•·æ™‚é–“å®Ÿè¡Œãƒªãƒã‚¸ãƒˆãƒª â†’ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

### ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º

- ä¸Šä½10åã®ã¿ä¿å­˜ â†’ JSONB ã‚µã‚¤ã‚ºç´„1-2KB/repo
- 500 repos Ã— 2KB = 1MBï¼ˆè¨±å®¹ç¯„å›²ï¼‰

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **æ­£å¸¸ç³»**
   - âœ… Contributors ãŒæ­£ã—ãå–å¾—ãƒ»è¡¨ç¤ºã•ã‚Œã‚‹
   - âœ… ã‚¢ãƒã‚¿ãƒ¼ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
   - âœ… "+N" è¡¨è¨˜ãŒæ­£ã—ã„

2. **ç•°å¸¸ç³»**
   - âœ… Contributors ãŒã„ãªã„ãƒªãƒã‚¸ãƒˆãƒª â†’ "-" è¡¨ç¤º
   - âœ… API ã‚¨ãƒ©ãƒ¼ â†’ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã€æ¬¡å›ãƒªãƒˆãƒ©ã‚¤
   - âœ… Rate limit â†’ ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶™ç¶š

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - âœ… 100 repos ã®ã‚¹ã‚­ãƒ£ãƒ³ãŒ10åˆ†ä»¥å†…ã«å®Œäº†
   - âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãŒ2ç§’ä»¥å†…

---

## ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

- **Phase 1**: ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨DBä¿å­˜ (1-2æ™‚é–“)
- **Phase 2**: UIå®Ÿè£… (1-2æ™‚é–“)
- **Phase 3**: æœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## å‚è€ƒè³‡æ–™

- [GitHub REST API - List repository contributors](https://docs.github.com/en/rest/repos/repos#list-repository-contributors)
- [Octokit pagination](https://github.com/octokit/plugin-paginate-rest.js)
